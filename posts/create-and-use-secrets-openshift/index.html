<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Creating and Using Secrets in OpenShift" /><meta property="og:locale" content="en" /><meta name="description" content="Creating Secrets (like creating ConfigMaps) is a vital part of Managing OpenShift workloads and is an exam objectives of the EX280 exam. Knowing how they work and how to configure them (from the command-line) will give you a better understanding of Secrets." /><meta property="og:description" content="Creating Secrets (like creating ConfigMaps) is a vital part of Managing OpenShift workloads and is an exam objectives of the EX280 exam. Knowing how they work and how to configure them (from the command-line) will give you a better understanding of Secrets." /><link rel="canonical" href="https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" /><meta property="og:url" content="https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" /><meta property="og:site_name" content="Christian’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-16T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Creating and Using Secrets in OpenShift" /><meta name="twitter:site" content="@CABenstein" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-05T16:01:10+01:00","datePublished":"2022-01-16T00:00:00+01:00","description":"Creating Secrets (like creating ConfigMaps) is a vital part of Managing OpenShift workloads and is an exam objectives of the EX280 exam. Knowing how they work and how to configure them (from the command-line) will give you a better understanding of Secrets.","headline":"Creating and Using Secrets in OpenShift","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingofspades.github.io/posts/create-and-use-secrets-openshift/"},"url":"https://kingofspades.github.io/posts/create-and-use-secrets-openshift/"}</script><title>Creating and Using Secrets in OpenShift | Christian's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Christian's Blog"><meta name="application-name" content="Christian's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/bio-photo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Christian's Blog</a></div><div class="site-subtitle">Stories of /dev/null</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/ex280/" class="nav-link"> <i class="fa-fw fas fa-graduation-cap ml-xl-3 mr-xl-3 unloaded"></i> <span>EX280</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KingOfSpades" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Creating and Using Secrets in OpenShift</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Creating and Using Secrets in OpenShift</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/KingOfSpades">Christian A. Benstein</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-16 00:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 16, 2022, 12:00 AM +0100" >Jan 16</em> </span> <span> Updated <em class="timeago" date="2022-02-05 16:01:10 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 5, 2022, 4:01 PM +0100" >Feb 5</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1150 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Creating Secrets (<a href="https://blog.benstein.nl/posts/setting-config-maps-from-the-cli/">like creating ConfigMaps</a>) is a vital part of Managing OpenShift workloads and is an exam objectives of the <a href="https://blog.benstein.nl/ex280/">EX280 exam</a>. Knowing how they work and how to configure them (from the command-line) will give you a better understanding of Secrets.</p><h1 id="secrets-how-do-they-work">Secrets, how do they work</h1><p>Secrets provide information (like config files or credentials) to workloads in your cluster. You can use a secret to provide a username and password to your pod or to add a SSL certificate to it.</p><h2 id="no-data-on-the-node">No data on the node<a href="#no-data-on-the-node"><i class="fas fa-hashtag"></i></a></h2></h2><p>When exposing secrets using volumes the data is stored in a <code class="language-plaintext highlighter-rouge">tmpfs</code> filesystem. This means that the data in de secret is not directly exposed to the node that the pod’s are running on<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p><p>This provides a bit more security than that of ConfigMaps.</p><h2 id="secret-types">Secret types<a href="#secret-types"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are 3 secret types available for you to us. Don’ worry, they are quite easy to keep apart:</p><ul><li><strong>docker-registry</strong> secrets are used by the internal docker registry of your container platform<li><strong>tls</strong> secrets are used to provide tls certificates, keys or other supporting files to a pod<li><strong>generic</strong> secrets are used to store everything from an API key to a config file</ul><p>I will be discussing <strong>generic</strong> secrets in this post.</p><h2 id="encoding-vs-encryption">Encoding vs Encryption<a href="#encoding-vs-encryption"><i class="fas fa-hashtag"></i></a></h2></h2><p>An important factor to know when working with secrets are that they are not encrypted. The “secret” part of secrets is that they are not readable without decoding them. By default secrets are encodes in a <code class="language-plaintext highlighter-rouge">base64</code> encoding. When you create a secret with, for example, a password <code class="language-plaintext highlighter-rouge">key=value</code> pair; the value will be encoded in <code class="language-plaintext highlighter-rouge">base64</code>.</p><p>We can simulate this in bash:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'encoded_password'</span> | <span class="nb">base64
</span><span class="nv">ZW5jb2RlZF9wYXNzd29yZAo</span><span class="o">=</span>

<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'ZW5jb2RlZF9wYXNzd29yZAo='</span> | <span class="nb">base64</span> <span class="nt">-d</span>
encoded_password
</pre></table></code></div></div><p>In this case the <code class="language-plaintext highlighter-rouge">key=value</code> pair would be rendered in our secret like this (because only the value is encoded, and not the key):</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="s">password=ZW5jb2RlZF9wYXNzd29yZAo=</span>
</pre></table></code></div></div><p>When we create a secret from <code class="language-plaintext highlighter-rouge">yaml</code> we need to encode it first. But when we create a secret with <code class="language-plaintext highlighter-rouge">oc create</code> the cluster takes care of this encoding for us. If you would use <code class="language-plaintext highlighter-rouge">oc edit</code> to live edit a secret, don’t forget to encode the string you are replacing.</p><h1 id="creating-a-secret">Creating a secret</h1><p>Creating a secret can be done by creating a <code class="language-plaintext highlighter-rouge">yaml</code> file and applying it to the cluster or by using the <code class="language-plaintext highlighter-rouge">oc create secret</code> command.</p><h2 id="creating-a-secret-from-yaml">Creating a secret from yaml<a href="#creating-a-secret-from-yaml"><i class="fas fa-hashtag"></i></a></h2></h2><p>Creating a secret form a <code class="language-plaintext highlighter-rouge">yaml</code> definition is quite easy when you know the layout. You always get an example from the <a href="https://docs.openshift.com/container-platform/4.6/nodes/pods/nodes-pods-secrets.html#nodes-pods-secrets-about-examples_nodes-pods-secrets">official documentation</a> or use <code class="language-plaintext highlighter-rouge">oc explain secrets</code></p><p>The following is a <code class="language-plaintext highlighter-rouge">yaml</code> secret with our own value filled in:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1"># our-secret.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">test-secret</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">project-of-secrets</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span> 
<span class="na">data</span><span class="pi">:</span> 
  <span class="na">password</span><span class="pi">:</span> <span class="s">ZW5jb2RlZF9wYXNzd29yZAo=</span>
</pre></table></code></div></div><p>If we wanted to create a secret from this we would do so with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc apply <span class="nt">-f</span> our-secret.yaml 
</pre></table></code></div></div><h2 id="creating-a-secret-from-the-cli">Creating a secret from the cli<a href="#creating-a-secret-from-the-cli"><i class="fas fa-hashtag"></i></a></h2></h2><p>If your in a hurry (or don’t want to create <code class="language-plaintext highlighter-rouge">yaml</code> files for all your secrets). You can create a secret without a definition file.</p><p>As a demo you can setup a special testing namespace. As you can see in my <code class="language-plaintext highlighter-rouge">yaml</code> example I called this one <code class="language-plaintext highlighter-rouge">project-of-secrets</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc new-project project-of-secrets 
</pre></table></code></div></div><h3 id="from-literal">From Literal<a href="#from-literal"><i class="fas fa-hashtag"></i></a></h3></h3><p>You could create a secret from the command-line with the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create secret generic <span class="se">\</span>
  SECRET_NAME <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="nv">KEY1</span><span class="o">=</span>VALUE1 <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="nv">KEY2</span><span class="o">=</span>VALUE2
</pre></table></code></div></div><p>As an example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create secret generic test-secret-literal <span class="se">\</span>
<span class="nt">--from-literal</span> <span class="nv">password</span><span class="o">=</span>encoded_secret 
secret/test-secret-literal created
</pre></table></code></div></div><h3 id="from-file">From File<a href="#from-file"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you want your secret to be filled with an entire file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create secret generic <span class="se">\</span>
  SECRET_NAME <span class="se">\</span>
  <span class="nt">--from-file</span> <span class="nv">KEY1</span><span class="o">=</span>/PATH/TO/FILE1 
</pre></table></code></div></div><p>As an example:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Our verry secret file"</span> <span class="o">&gt;</span> secret-file.txt
<span class="nv">$ </span>oc create secret generic test-secret-file <span class="nt">--from-file</span> secret-file.txt
secret/test-secret-file created
</pre></table></code></div></div><h2 id="adding-a-secret-to-a-pod">Adding a secret to a pod<a href="#adding-a-secret-to-a-pod"><i class="fas fa-hashtag"></i></a></h2></h2><p>Secrets can be supplied to a pod much like ConfigMaps. For more info on those, I wrote an entire <a href="https://blog.benstein.nl/posts/setting-config-maps-from-the-cli/">blog regarding the creation and usage of them</a>.</p><p>Just like ConfigMaps we can provide secret data to pods as ENV variables or as a volume. We will use the <code class="language-plaintext highlighter-rouge">secret/test-secret-literal</code> and our <code class="language-plaintext highlighter-rouge">demoapp</code> as an example, you can create a demo app with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc new-app <span class="nt">--name</span> demoapp <span class="nt">--docker-image</span> bitnami/nginx
<span class="nt">--</span><span class="o">&gt;</span> Creating resources ...
    imagestream.image.openshift.io <span class="s2">"demoapp"</span> created
    deployment.apps <span class="s2">"demoapp"</span> created
    service <span class="s2">"demoapp"</span> created
</pre></table></code></div></div><h3 id="secret-as-env-variable">Secret as ENV Variable<a href="#secret-as-env-variable"><i class="fas fa-hashtag"></i></a></h3></h3><p>We use the <code class="language-plaintext highlighter-rouge">oc set env</code> command to set a secret as ENV Vars for our pod:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc <span class="nb">set env </span>deployment/demoapp <span class="se">\</span>
<span class="nt">--from</span> secret/test-secret-literal
deployment.extensions/demoapp updated 
</pre></table></code></div></div><p>We can now see the secret in action when we enter the pod:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc get pods
NAME                       READY   STATUS    RESTARTS   AGE
demoapp-557f47dccb-2gzvp   1/1     Running   0          41s
<span class="nv">$ </span>oc rsh demoapp-557f47dccb-2gzvp bash
<span class="o">(</span>pod<span class="o">)</span> <span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep</span> <span class="nt">-i</span> password
<span class="nv">PASSWORD</span><span class="o">=</span>encoded_secret
</pre></table></code></div></div><h3 id="using-a-prefix">Using a prefix<a href="#using-a-prefix"><i class="fas fa-hashtag"></i></a></h3></h3><p>You can also prefix your secrets in the pod using the <code class="language-plaintext highlighter-rouge">--prefix</code> option. This will add a prefix like <code class="language-plaintext highlighter-rouge">mysql_</code> or <code class="language-plaintext highlighter-rouge">our_prefix_</code> to all the key’s that are being added. Tis can be quite handy for example when you want to use the <code class="language-plaintext highlighter-rouge">mysql</code> app because that app expects all values to be prefixed.</p><p>As an example, we will create a secret from-literal and then add it with a prefix:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create secret generic prefix-example <span class="se">\</span>
  <span class="nt">--from-literal</span> <span class="nv">key</span><span class="o">=</span>a_value
secret/prefix-example created
</pre></table></code></div></div><p>And then we add it with the <code class="language-plaintext highlighter-rouge">--prefix</code> option:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc <span class="nb">set env </span>deployment/demoapp <span class="se">\</span>
  <span class="nt">--from</span> secret/prefix-example <span class="se">\</span>
  <span class="nt">--prefix</span> our_prefix_ <span class="se">\</span>
deployment.extensions/demoapp updated
</pre></table></code></div></div><p>Now, when we enter the pod and echo the ENV variables we will see the <code class="language-plaintext highlighter-rouge">key</code> being prefixed:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc get pods <span class="nt">-o</span> name
pod/demoapp-6c9b77c-dw4c2
<span class="nv">$ </span>oc rsh pod/demoapp-6c9b77c-dw4c2 bash
<span class="o">(</span>pod<span class="o">)</span> <span class="nv">$ </span><span class="nb">env</span> | <span class="nb">grep</span> <span class="nt">-i</span> <span class="s1">'key'</span>
<span class="nv">our_prefix_KEY</span><span class="o">=</span>a_value
</pre></table></code></div></div><h3 id="secret-as-file">Secret as file<a href="#secret-as-file"><i class="fas fa-hashtag"></i></a></h3></h3><div class="alert alert-danger" role="alert"><i class="fa fa-exclamation-circle"></i> <b>Warning:</b> Mounting a volume on path that already exists on a pod will make all files in that directory inaccessible</div><p>To create a volume that will hold the secret we use the <code class="language-plaintext highlighter-rouge">oc set volume</code> command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc <span class="nb">set </span>volume <span class="se">\</span>
  deployment/demoapp <span class="se">\</span>
  <span class="nt">--add</span> <span class="se">\</span>
  <span class="nt">--type</span> secret <span class="se">\</span>
  <span class="nt">--mount-path</span> /etc/secret <span class="se">\</span>
  <span class="nt">--secret-name</span> test-secret-literal
info: Generated volume name: volume-zjmsq
deployment.extensions/demoapp volume updated 
</pre></table></code></div></div><p>We can see the mounted secret action from the pod in actions as well:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>rsh demoapp-557f47dccb-2gzvp bash
<span class="o">(</span>pod<span class="o">)</span> <span class="nv">$ </span><span class="nb">cat</span> /etc/secret/password
encoded_secret
</pre></table></code></div></div><p>As you can see a file is created with the name of the <code class="language-plaintext highlighter-rouge">key</code> containing the value of the <code class="language-plaintext highlighter-rouge">value</code> from our secret.</p><h1 id="closing-thoughts">Closing thoughts</h1><p>Secrets might not be as secret as you would hope but they provide a fundamental way of exposing sensitive data to our pods on OpenShift and you will certainly encounter them on a daily basis if you manage any kind of Container Cluster.</p><p>See more of my <a href="https://blog.benstein.nl/ex280/">EX280 and OpenShift related posts here </a></p><div class="footnotes" role="doc-endnotes"><ol><li id="fn:1" role="doc-endnote"><p>https://docs.openshift.com/container-platform/4.9/nodes/pods/nodes-pods-secrets.html#nodes-pods-secrets-about_nodes-pods-secrets <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ex280/'>EX280</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/openshift/" class="post-tag no-text-decoration" >openshift</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/ex280/" class="post-tag no-text-decoration" >ex280</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Creating and Using Secrets in OpenShift - Christian's Blog&url=https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Creating and Using Secrets in OpenShift - Christian's Blog&u=https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Creating and Using Secrets in OpenShift - Christian's Blog&url=https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kingofspades.github.io/posts/create-and-use-secrets-openshift/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hey-for-loadtesting-http/">hey for load testing http applications</a><li><a href="/posts/building-the-montsinger-rebound-s/">Build-log: Montsinger Rebound-S</a><li><a href="/posts/lets-get-fuzzy/">Let's get fuzzys</a><li><a href="/posts/creating-a-ex280-page/">Creating my EX280 page on Jekyll</a><li><a href="/posts/troubelshooting-permissions-on-pods/">ServiceAccounts and SCCs - Running pods with more permission's</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/controlling-pod-rollout-and-scaling/"><div class="card-body"> <em class="timeago small" date="2022-01-23 00:00:00 +0100" >Jan 23</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Scaling applications - Rollout, Scale and Auto-Scale Deployments</h3><div class="text-muted small"><p> This post is gonna be a bit bigger broader then what is requested on the EX280 exam objectives. In this post we will have a look at: Controlling roll-out of pods (manually rolling out or back a ...</p></div></div></a></div><div class="card"> <a href="/posts/quotas-limits-and-limit-ranges/"><div class="card-body"> <em class="timeago small" date="2022-01-29 00:00:00 +0100" >Jan 29</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Quotas, limits and limit-ranges</h3><div class="text-muted small"><p> In this post we will be diving in to quotas and limits. Quotas and limits can be used to allocate, limit en reserve resources within your cluster for one or multiple namepaces and can limit the usa...</p></div></div></a></div><div class="card"> <a href="/posts/pod-affinity-and-anti-affinity/"><div class="card-body"> <em class="timeago small" date="2022-02-06 00:00:00 +0100" >Feb 6</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pod Affinity and Anti-affinity - Spreading out workloads</h3><div class="text-muted small"><p> I have written about using Taints and Tolerations to prevent pods from running on certain (tainted) nodes and there is some influence on scheduling that we can exert using Limits and Requests. But...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/creating-a-ex280-page/" class="btn btn-outline-primary" prompt="Older"><p>Creating my EX280 page on Jekyll</p></a> <a href="/posts/troubelshooting-permissions-on-pods/" class="btn btn-outline-primary" prompt="Newer"><p>ServiceAccounts and SCCs - Running pods with more permission's</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://kingofspades.github.io/posts/create-and-use-secrets-openshift/'; this.page.identifier = '/posts/create-and-use-secrets-openshift/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https-blog-benstein-nl.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/KingOfSpades">Christian A. Benstein</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9VZBEPDENQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9VZBEPDENQ'); }); </script>
