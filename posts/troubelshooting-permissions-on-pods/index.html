<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="ServiceAccounts and SCCs - Running pods with more permission’s" /><meta property="og:locale" content="en" /><meta name="description" content="In this blog we will take a look at SCC permissions that are needed to run a pod with escalated permissions and how to use a serviceaccount (sa) to run such a pod or deployment." /><meta property="og:description" content="In this blog we will take a look at SCC permissions that are needed to run a pod with escalated permissions and how to use a serviceaccount (sa) to run such a pod or deployment." /><link rel="canonical" href="https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" /><meta property="og:url" content="https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" /><meta property="og:site_name" content="Christian’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-17T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ServiceAccounts and SCCs - Running pods with more permission’s" /><meta name="twitter:site" content="@CABenstein" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-28T12:09:16+01:00","datePublished":"2022-01-17T00:00:00+01:00","description":"In this blog we will take a look at SCC permissions that are needed to run a pod with escalated permissions and how to use a serviceaccount (sa) to run such a pod or deployment.","headline":"ServiceAccounts and SCCs - Running pods with more permission’s","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/"},"url":"https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/"}</script><title>ServiceAccounts and SCCs - Running pods with more permission's | Christian's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Christian's Blog"><meta name="application-name" content="Christian's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/bio-photo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Christian's Blog</a></div><div class="site-subtitle">Stories of /dev/null</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/ex280/" class="nav-link"> <i class="fa-fw fas fa-graduation-cap ml-xl-3 mr-xl-3 unloaded"></i> <span>EX280</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KingOfSpades" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>ServiceAccounts and SCCs - Running pods with more permission's</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ServiceAccounts and SCCs - Running pods with more permission's</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/KingOfSpades">Christian A. Benstein</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-17 00:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 17, 2022, 12:00 AM +0100" >Jan 17</em> </span> <span> Updated <em class="timeago" date="2022-02-28 12:09:16 +0100 " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 28, 2022, 12:09 PM +0100" >Feb 28</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1555 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>In this blog we will take a look at SCC permissions that are needed to run a pod with escalated permissions and how to use a serviceaccount (<code class="language-plaintext highlighter-rouge">sa</code>) to run such a pod or deployment.</p><p>Small thing: I use the term pod and container in this post but I’m referring to the same idea. In Openshift and Kubernetes we talk about pods being the smallest unit of measurement. Each pod usually runs one container but there are pods that run multiple containers.</p><h1 id="understanding-rootless">Understanding Rootless</h1><p>I won’t explain fully why and what rootless means in general but will focus on the parts that are importent to know in a Openshift environment and according to the <a href="https://www.redhat.com/en/services/training/ex280-red-hat-certified-specialist-in-openshift-administration-exam?section=Objectives">EX280 exam objectives</a>. If you do wanna go deep on rootless, namespaces and more I highly recommend the following video’s by RedHat:</p><ul><li><a href="https://www.youtube.com/watch?v=ZgXpWKgQclc">Overview of Rootless Podman: Part 1 - Understanding Root Inside and Outside a Container</a><li><a href="https://www.youtube.com/watch?v=Ac2boGEz2ww">Overview of Rootless Podman: Part 2 - How User Namespaces Work in Rootless Containers</a></ul><h2 id="uids-and-namespaces">UIDs and Namespaces<a href="#uids-and-namespaces"><i class="fas fa-hashtag"></i></a></h2></h2><p>So what are Namespaces? A namespace is a feature of the Linux kernel that allows you to segment resources <sup id="fnref:Wiki2022" role="doc-noteref"><a href="#fn:Wiki2022" class="footnote" rel="footnote">1</a></sup>. All things that make up a running system or process are at home in a Namespace. You’ll find Process ID’s (PID) in there as well as mounts and user ID’s (UID). Simply said, a Namespace is a organizational container to partition resources in. Now, your Linux base system has a great way of orchestrating all these different resources based on their unique ID’s and maps process ID’s that are spawned inside a container back to the host system so that the stuff that needs running (the processes that make up the containers) can actually get resources and stay separated from each other.</p><p>So, when we are talking about container technology and containers being “contained” we are actually talking about this awesome namespace feature.</p><h2 id="so-what-are-the-risks">So, what are the risks?<a href="#so-what-are-the-risks"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are different risks associated with running containers that default to a root account. The obvious risk is the same as on normal Linux server. Imagine all accounts that are available on a Linux host having root privileges. Now imagine someone gaining access to that system. When you run a pod that defaults to the root account (aka a root container) you’re basically exposing the same risk. You can have all the security of a cluster, but if someone manages to drop a executable in a pod or gain access to it they could do a lot of damage.</p><p>If you want to go deeper on rootless containers, the risks and how to avoid them, <a href="https://www.youtube.com/watch?v=YrN49thJREY">check out this video by Synk</a>.</p><h2 id="openshift-to-the-rescue">Openshift to the rescue(?)<a href="#openshift-to-the-rescue"><i class="fas fa-hashtag"></i></a></h2></h2><p>One of the things that Openshift takes care of (in comparison with the out-of-the-box Kubernetes cluster) is that it won’t allow root containers to run by default. This can lead to some issues as some containers need more access to the underling host or special resources or that the images are not setup for rootless usage. For these cases Openshift provides Security Context Constraints to manage elevated rights for pods.</p><h1 id="sccs-and-sas">SCC’s and SA’s</h1><p>SCC? SA? What do you mean? Let me (try) to explain:</p><ul><li><p><strong>SCC:</strong> Security Context Constrains. A SCC is used to provide access to a certain resource like: <code class="language-plaintext highlighter-rouge">anyuid</code> (which allows the pod to run under any UID), <code class="language-plaintext highlighter-rouge">hostaccess</code> (which gives the pod host access) and <code class="language-plaintext highlighter-rouge">hostnetwork</code> (which, well I’ll let you guess that one yourself)</p><p>To see all SCCs that are available in you cluster you can use:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="nv">$ </span>oc get scc <span class="nt">-o</span> name
  securitycontextconstraints.security.openshift.io/anyuid
  securitycontextconstraints.security.openshift.io/hostaccess
  securitycontextconstraints.security.openshift.io/hostmount-anyuid
  securitycontextconstraints.security.openshift.io/hostnetwork
  securitycontextconstraints.security.openshift.io/machine-api-termination-handler
  securitycontextconstraints.security.openshift.io/nonroot
  securitycontextconstraints.security.openshift.io/privileged
  securitycontextconstraints.security.openshift.io/restricted 
</pre></table></code></div></div><p>(to see more details, use <code class="language-plaintext highlighter-rouge">oc get scc</code>)</p><li><p><strong>SA:</strong> A Service Account is used to run a pod with a special SCC. In Openshift you create Service Accounts and bind them to a deployment to hand out permissions. You can see</p></ul><h1 id="running-a-container-with-elevated-permissions">Running a container with elevated permissions</h1><p>A great container image to use as an example for this post is the <code class="language-plaintext highlighter-rouge">nginx</code> container which is available in both a root a rootless version. For our example we will create two apps based on the two different images. One is the official <code class="language-plaintext highlighter-rouge">nginx</code> container image and the second one is the <code class="language-plaintext highlighter-rouge">bitnami/nginx</code> rootless version:</p><h2 id="creating-the-deployments">Creating the deployments<a href="#creating-the-deployments"><i class="fas fa-hashtag"></i></a></h2></h2><p>We will create a new namespace and two apps:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc new-project root-more-or-less
<span class="nv">$ </span>oc new-app <span class="nt">--name</span> root-container <span class="nt">--image</span> docker.io/nginx
<span class="nv">$ </span>oc new-app <span class="nt">--name</span> rootless-container <span class="nt">--image</span> docker.io/bitnami/nginx
</pre></table></code></div></div><p>Strait away we can see some issues with our root pod:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc get pods
NAME                                  READY   STATUS    RESTARTS      AGE
root-container-67c49b777d-wdzn5       0/1     Error     3 <span class="o">(</span>28s ago<span class="o">)</span>   58s
rootless-container-59c496f955-zh7qd   1/1     Running   0             76s 
</pre></table></code></div></div><h2 id="troubleshooting">Troubleshooting<a href="#troubleshooting"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s have a look at whats going on here. We will start with a simple <code class="language-plaintext highlighter-rouge">oc status</code> command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc status <span class="nt">--suggest</span>
....
Errors:
  <span class="k">*</span> pod/root-container-67c49b777d-wdzn5 is crash-looping

The container is starting and exiting repeatedly. This usually means the container is unable to start, misconfigured, or limited by security restrictions. Check the container logs with

      oc logs root-container-67c49b777d-wdzn5 <span class="nt">-c</span> root-container

Current security policy prevents your containers from being run as the root user. Some images may fail expecting to be able to change ownership or permissions on directories. Your admin can grant you access to run containers that need to run as the root user with this <span class="nb">command</span>:

      oc adm policy add-scc-to-user anyuid <span class="nt">-n</span> root-or-less <span class="nt">-z</span> default
....
</pre></table></code></div></div><p>Of the bat we get two hints of fixing this. <code class="language-plaintext highlighter-rouge">oc status</code> is telling us to check the logs of the pod and that the pod might not be able to run due to a SCC. Let’s not blindly follow the suggestion of adding <code class="language-plaintext highlighter-rouge">anyuid</code> to this pod and explore further with the logs:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc logs root-container-67c49b777d-wdzn5
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="k">for </span>shell scripts <span class="k">in</span> /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: can not modify /etc/nginx/conf.d/default.conf <span class="o">(</span>read-only file system?<span class="o">)</span>
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration <span class="nb">complete</span><span class="p">;</span> ready <span class="k">for </span>start up
2022/01/22 15:51:47 <span class="o">[</span>warn] 1#1: the <span class="s2">"user"</span> directive makes sense only <span class="k">if </span>the master process runs with super-user privileges, ignored <span class="k">in</span> /etc/nginx/nginx.conf:2
nginx: <span class="o">[</span>warn] the <span class="s2">"user"</span> directive makes sense only <span class="k">if </span>the master process runs with super-user privileges, ignored <span class="k">in</span> /etc/nginx/nginx.conf:2
2022/01/22 15:51:47 <span class="o">[</span>emerg] 1#1: <span class="nb">mkdir</span><span class="o">()</span> <span class="s2">"/var/cache/nginx/client_temp"</span> failed <span class="o">(</span>13: Permission denied<span class="o">)</span>
nginx: <span class="o">[</span>emerg] <span class="nb">mkdir</span><span class="o">()</span> <span class="s2">"/var/cache/nginx/client_temp"</span> failed <span class="o">(</span>13: Permission denied<span class="o">)</span>
</pre></table></code></div></div><p>As we can see, the pod is expecting to be run as a root user:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="o">[</span>warn] 1#1: the <span class="s2">"user"</span> directive makes sense only <span class="k">if </span>the master process runs with super-user privileges, ignored <span class="k">in</span> /etc/nginx/nginx.conf:2
</pre></table></code></div></div><p>Before we fix this, let’s check out the SCC’s the pod’s are currently using:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc describe pod | <span class="nb">grep</span> <span class="nt">-i</span> SCC
    openshift.io/scc: restricted
    openshift.io/scc: restricted
</pre></table></code></div></div><p>Now lets use this amazing policy command to find out what SCC our root container wants to user:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc get pod root-container-67c49b777d-wdzn5 <span class="nt">-o</span> yaml <span class="se">\</span>
  | oc adm policy scc-subject-review <span class="nt">-f</span> -
RESOURCE                              ALLOWED BY
Pod/root-container-67c49b777d-wdzn5   anyuid
</pre></table></code></div></div><p>Looks like our pod wants to use <code class="language-plaintext highlighter-rouge">anyuid</code> just as suggested when we ran the <code class="language-plaintext highlighter-rouge">oc status</code> command.</p><h2 id="creating-a-serviceaccount">Creating a ServiceAccount<a href="#creating-a-serviceaccount"><i class="fas fa-hashtag"></i></a></h2></h2><p>As mentioned before, if you want to run a pod with a different SCC you’ll need to create a ServiceAccount to run the pod. The SA will provide the runtime with the elevated permissions that we add to the SA</p><p>We will create a SA called <code class="language-plaintext highlighter-rouge">ok-go-for-it</code> in our namespace with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create sa ok-go-for-it <span class="se">\</span>
  <span class="nt">--namespace</span> root-more-or-less
  serviceaccount/ok-go-for-it created
</pre></table></code></div></div><p>A small tip, always create the SA with a <code class="language-plaintext highlighter-rouge">--namespace</code> (or <code class="language-plaintext highlighter-rouge">-n</code>) flag to ensure the SA is bound to the namespace.</p><h3 id="giving-special-permissions-to-a-serviceaccount">Giving special permissions to a ServiceAccount<a href="#giving-special-permissions-to-a-serviceaccount"><i class="fas fa-hashtag"></i></a></h3></h3><p>Now let’s add some permissions to our brand spanking new SA. We use <code class="language-plaintext highlighter-rouge">oc adm policy</code> to add permissions to users, groups and ServiceAccounts. When we add permissions to a SA we use the <code class="language-plaintext highlighter-rouge">-z</code> flag:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc adm policy add-scc-to-user <span class="nt">-h</span>
Add a security context constraint to <span class="nb">users </span>or a service account.

Usage:
  oc adm policy add-scc-to-user SCC <span class="o">(</span>USER | <span class="nt">-z</span> SERVICEACCOUNT<span class="o">)</span> <span class="o">[</span>USER ...] <span class="o">[</span>flags 
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc adm policy add-scc-to-user anyuid <span class="se">\</span>
  <span class="nt">-z</span> ok-go-for-it <span class="se">\</span>
  <span class="nt">--namespace</span> root-more-or-less
clusterrole.rbac.authorization.k8s.io/system:openshift:scc:anyuid added: <span class="s2">"ok-go-for-it"</span>
</pre></table></code></div></div><h3 id="adding-a-serviceaccount-to-a-deployment">Adding a ServiceAccount to a Deployment<a href="#adding-a-serviceaccount-to-a-deployment"><i class="fas fa-hashtag"></i></a></h3></h3><p>Now to update our app. We got our SA ready and our permissions permitted. Let’s not waist time with editing <code class="language-plaintext highlighter-rouge">yaml</code> and set the serviceaccount for our app using <code class="language-plaintext highlighter-rouge">oc set</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc <span class="nb">set </span>serviceaccount deployment root-container ok-go-for-it
deployment.apps/root-container serviceaccount updated
</pre></table></code></div></div><p>And just to verify:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc get pods
NAME                                  READY   STATUS    RESTARTS   AGE
root-container-5d6c7cc66b-sqhhs       1/1     Running   0          19s
rootless-container-59c496f955-zh7qd   1/1     Running   0          20m 
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc describe pod | <span class="nb">grep</span> <span class="nt">-i</span> SCC
              openshift.io/scc: anyuid
              openshift.io/scc: restricted
</pre></table></code></div></div><h1 id="wrapping-up">Wrapping up</h1><p>As you can see it’s pretty easy to use SAs to apply special permissions to deployments. That doesn’t mean you should do it without thought. There are use cases in which it’s necessary that a deployment might need to run with elevated permissions but there are a lot of other solution’s than simply handing out the permissions. So stay sharp!</p><p>Do you want to see more of my EX280 post’s? Checkout my <a href="https://blog.benstein.nl/ex280/">EX280 page</a></p><div class="footnotes" role="doc-endnotes"><ol><li id="fn:Wiki2022" role="doc-endnote"><p>https://en.wikipedia.org/wiki/Linux_namespaces <a href="#fnref:Wiki2022" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ex280/'>EX280</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/openshift/" class="post-tag no-text-decoration" >openshift</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/ex280/" class="post-tag no-text-decoration" >ex280</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ServiceAccounts and SCCs - Running pods with more permission's - Christian's Blog&url=https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ServiceAccounts and SCCs - Running pods with more permission's - Christian's Blog&u=https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ServiceAccounts and SCCs - Running pods with more permission's - Christian's Blog&url=https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hey-for-loadtesting-http/">hey for load testing http applications</a><li><a href="/posts/building-the-montsinger-rebound-s/">Build-log: Montsinger Rebound-S</a><li><a href="/posts/lets-get-fuzzy/">Let's get fuzzys</a><li><a href="/posts/creating-a-ex280-page/">Creating my EX280 page on Jekyll</a><li><a href="/posts/troubelshooting-permissions-on-pods/">ServiceAccounts and SCCs - Running pods with more permission's</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/controlling-pod-rollout-and-scaling/"><div class="card-body"> <em class="timeago small" date="2022-01-23 00:00:00 +0100" >Jan 23</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Scaling applications - Rollout, Scale and Auto-Scale Deployments</h3><div class="text-muted small"><p> This post is gonna be a bit bigger broader then what is requested on the EX280 exam objectives. In this post we will have a look at: Controlling roll-out of pods (manually rolling out or back a ...</p></div></div></a></div><div class="card"> <a href="/posts/quotas-limits-and-limit-ranges/"><div class="card-body"> <em class="timeago small" date="2022-01-29 00:00:00 +0100" >Jan 29</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Quotas, limits and limit-ranges</h3><div class="text-muted small"><p> In this post we will be diving in to quotas and limits. Quotas and limits can be used to allocate, limit en reserve resources within your cluster for one or multiple namepaces and can limit the usa...</p></div></div></a></div><div class="card"> <a href="/posts/pod-affinity-and-anti-affinity/"><div class="card-body"> <em class="timeago small" date="2022-02-06 00:00:00 +0100" >Feb 6</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pod Affinity and Anti-affinity - Spreading out workloads</h3><div class="text-muted small"><p> I have written about using Taints and Tolerations to prevent pods from running on certain (tainted) nodes and there is some influence on scheduling that we can exert using Limits and Requests. But...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/create-and-use-secrets-openshift/" class="btn btn-outline-primary" prompt="Older"><p>Creating and Using Secrets in OpenShift</p></a> <a href="/posts/controlling-pod-rollout-and-scaling/" class="btn btn-outline-primary" prompt="Newer"><p>Scaling applications - Rollout, Scale and Auto-Scale Deployments</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://kingofspades.github.io/posts/troubelshooting-permissions-on-pods/'; this.page.identifier = '/posts/troubelshooting-permissions-on-pods/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https-blog-benstein-nl.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/KingOfSpades">Christian A. Benstein</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9VZBEPDENQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9VZBEPDENQ'); }); </script>
