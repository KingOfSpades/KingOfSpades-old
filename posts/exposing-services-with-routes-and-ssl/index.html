<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Exposing services with routes and SSL" /><meta property="og:locale" content="en" /><meta name="description" content="This blog will go in to “Configure networking components” objective of the EX280 exam from RedHat. In this post we will:" /><meta property="og:description" content="This blog will go in to “Configure networking components” objective of the EX280 exam from RedHat. In this post we will:" /><link rel="canonical" href="https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" /><meta property="og:url" content="https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" /><meta property="og:site_name" content="Christian’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-26T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Exposing services with routes and SSL" /><meta name="twitter:site" content="@CABenstein" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-26T16:44:14+01:00","datePublished":"2022-02-26T00:00:00+01:00","description":"This blog will go in to “Configure networking components” objective of the EX280 exam from RedHat. In this post we will:","headline":"Exposing services with routes and SSL","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/"},"url":"https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/"}</script><title>Exposing services with routes and SSL | Christian's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Christian's Blog"><meta name="application-name" content="Christian's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.updateMermaid(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/bio-photo.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Christian's Blog</a></div><div class="site-subtitle">Stories of /dev/null</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/ex280/" class="nav-link"> <i class="fa-fw fas fa-graduation-cap ml-xl-3 mr-xl-3 unloaded"></i> <span>EX280</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KingOfSpades" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Exposing services with routes and SSL</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Exposing services with routes and SSL</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/KingOfSpades">Christian A. Benstein</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-02-26 00:00:00 +0100" data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 26, 2022, 12:00 AM +0100" >Feb 26</em> </span> <span> Updated <em class="timeago" date="2022-02-26 16:44:14 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Feb 26, 2022, 4:44 PM +0100" >Feb 26</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1283 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>This blog will go in to <a href="https://www.redhat.com/en/services/training/ex280-red-hat-certified-specialist-in-openshift-administration-exam?section=Objectives">“Configure networking components”</a> objective of the <a href="https://www.redhat.com/en/services/training/ex280-red-hat-certified-specialist-in-openshift-administration-exam?section=Overview">EX280</a> exam from RedHat. In this post we will:</p><ul><li>Have a look at services<li>Expose a service with a URL<li>Check out the types of routes we can create<li>Creating a route to a service that is encrypted with SSL</ul><p>As always. We will be doing all the examples in a CRC (<a href="https://developers.redhat.com/products/codeready-containers/overview">Code Ready Containers</a>) environment.</p><h1 id="understanding-services">Understanding services</h1><p>Lets start with the last component when connecting to an application that is running in OpenShift, the <code class="language-plaintext highlighter-rouge">pod</code> where the application is running. How does it get here? When you create a application using <code class="language-plaintext highlighter-rouge">oc new-app</code> the cluster automatically creates a <code class="language-plaintext highlighter-rouge">service</code> for you (checkout <code class="language-plaintext highlighter-rouge">oc explain service</code>).</p><p>A <code class="language-plaintext highlighter-rouge">service</code> acts as a load balancer for your pod(s) running your application. This way, no matter how many pods you have running (or where they are running) there is a single service object that can be used to access them.</p><pre><code class="language-mermaid">flowchart LR
    subgraph Internet
    Client
    end
    subgraph Openshift
    Client --&gt;|Public URL| Route
    Route --&gt; Service
        subgraph Namespace
        Service --&gt; Pod01
        Service --&gt; Pod02
        Service --&gt; Pod03 
        end
    end
</code></pre><h2 id="services-in-detail">Services in detail<a href="#services-in-detail"><i class="fas fa-hashtag"></i></a></h2></h2><p>A service {object} in Openshift can look like this:</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">openshift.io/generated-by</span><span class="pi">:</span> <span class="s">OpenShiftNewApp</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">app.kubernetes.io/component</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">clusterIP</span><span class="pi">:</span> <span class="s">10.217.4.22</span>
  <span class="na">clusterIPs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">10.217.4.22</span>
  <span class="na">internalTrafficPolicy</span><span class="pi">:</span> <span class="s">Cluster</span>
  <span class="na">ipFamilies</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">IPv4</span>
  <span class="na">ipFamilyPolicy</span><span class="pi">:</span> <span class="s">SingleStack</span>
  <span class="na">ports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">8080-tcp</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">8443-tcp</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">8443</span>
    <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
    <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8443</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">deployment</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">sessionAffinity</span><span class="pi">:</span> <span class="s">None</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">ClusterIP</span>
<span class="na">status</span><span class="pi">:</span>
  <span class="na">loadBalancer</span><span class="pi">:</span> <span class="pi">{}</span>
</pre></table></code></div></div><p>In this example we can see:</p><ul><li>That the cluster ip of this service (the IP that can be used to reach the pods) is <code class="language-plaintext highlighter-rouge">10.217.4.22</code><li>That this route will send traffic to deployments with a <code class="language-plaintext highlighter-rouge">selector</code> (<code class="language-plaintext highlighter-rouge">deployment: nginx</code>)<li>The type of this service is <code class="language-plaintext highlighter-rouge">ClusterIP</code>. This is the default. There are more types, check them out at the <a href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types">Kubernetes Service Types</a> page</ul><h1 id="understanding-routes">Understanding Routes</h1><p>We can access the pods using a service with an IP. Great, but no one (hopefully) is typing IP’s in to their browser on a daily basis to get to your app. That’s where <code class="language-plaintext highlighter-rouge">routes</code> come in to play. With a route we can expose our service with a http URL like <code class="language-plaintext highlighter-rouge">amazing-app.ourcluster.com</code>. And if we configure Openshift even further we can make things available on base domains like <code class="language-plaintext highlighter-rouge">amazing-app.com</code>. Routes are used by the central cluster ingress (the point where all the traffic comes in) to route (pun!) the traffic to the right service.</p><h2 id="expose-vs-route"><code class="language-plaintext highlighter-rouge">expose</code> vs <code class="language-plaintext highlighter-rouge">route</code><a href="#expose-vs-route"><i class="fas fa-hashtag"></i></a></h2></h2><p>There are two (2) ways to create a route. <code class="language-plaintext highlighter-rouge">oc expose</code> and <code class="language-plaintext highlighter-rouge">oc create route</code>. When we talk about creating a route we often jump to the latter because it has ‘route’ in it’s name. It is even the one we should be using because <code class="language-plaintext highlighter-rouge">oc create route</code> is used to create Secure routes. And here lies the difference in the two. When using <code class="language-plaintext highlighter-rouge">expose</code> we can expose our service in a number of different ways which include using a <code class="language-plaintext highlighter-rouge">http</code> hostname. When using <code class="language-plaintext highlighter-rouge">oc create route</code> we can create a secure route that uses TLS/SSL to encrypt the traffic.</p><h2 id="types-of-secure-routes">Types of secure routes<a href="#types-of-secure-routes"><i class="fas fa-hashtag"></i></a></h2></h2><p>When using <code class="language-plaintext highlighter-rouge">oc create route</code> we have to choose between a set of different types of routes, these are:</p><ul><li><strong>Edge:</strong> This will expose a route on the <em>edge</em> of your cluster. The route will contain the SSL certificate files. Once the traffic goes to the service it will no longe be encrypted<li><strong>Passtrough:</strong> This will connect you pod directly to the cluster Ingress. The SSL certificate will be stored in the pod<li><strong>Reencrypt</strong>: Is a combination of Edge and Passtrough. It will re encrypt the traffic once it is passed the Ingress</ul><h1 id="exposing-an-application">Exposing an application</h1><p>We will now move on to some examples, we will:</p><ol><li>Create a route using <code class="language-plaintext highlighter-rouge">expose</code> to create our route on <code class="language-plaintext highlighter-rouge">http</code><li>We will create a safe edge route using a SSL certificate</ol><blockquote class="prompt-tip"><p>You can find instructions on how to create a Self Signed Certificate <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/system_administration_guide/apache_http_secure_server_configuration-creating_a_self_signed_certificate">here</a></p></blockquote><h2 id="creating-a-route">Creating a route<a href="#creating-a-route"><i class="fas fa-hashtag"></i></a></h2></h2><p>We will create a route called <code class="language-plaintext highlighter-rouge">unsecure-route</code> on our app called <code class="language-plaintext highlighter-rouge">unsecure-app</code> in the namespace: <code class="language-plaintext highlighter-rouge">this-is-insecure</code>. The route will be <code class="language-plaintext highlighter-rouge">insecure-app-this-is-insecure.apps-crc.testing</code> because we are on CRC. Let’s get started:</p><p>Creating a project and a simple app:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc new-project this-is-insecure
<span class="nv">$ </span>oc new-app <span class="nt">--name</span> insecure-app <span class="nt">--image</span> bitnami/nginx
<span class="nt">--</span><span class="o">&gt;</span> Found container image 2309fdc <span class="o">(</span>15 hours old<span class="o">)</span> from Docker Hub <span class="k">for</span> <span class="s2">"bitnami/nginx"</span>

    <span class="k">*</span> An image stream tag will be created as <span class="s2">"insecure-app:latest"</span> that will track this image

<span class="nt">--</span><span class="o">&gt;</span> Creating resources ...
    imagestream.image.openshift.io <span class="s2">"insecure-app"</span> created
    deployment.apps <span class="s2">"insecure-app"</span> created
    service <span class="s2">"insecure-app"</span> created
<span class="nt">--</span><span class="o">&gt;</span> Success
    Application is not exposed. You can expose services to the outside world by executing one or more of the commands below:
     <span class="s1">'oc expose service/insecure-app'</span>
    Run <span class="s1">'oc status'</span> to view your app.
</pre></table></code></div></div><p>Creating our route using <code class="language-plaintext highlighter-rouge">expose</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span> oc expose service/insecure-app <span class="se">\</span>
  <span class="nt">--name</span> unsecure-route <span class="se">\</span>
  <span class="nt">--hostname</span> insecure-app-this-is-insecure.apps-crc.testing
route.route.openshift.io/unsecure-route expos 
</pre></table></code></div></div><h3 id="testing-our-route">Testing our route<a href="#testing-our-route"><i class="fas fa-hashtag"></i></a></h3></h3><p>Testing can be done by spinning up another container or using the <code class="language-plaintext highlighter-rouge">oc debug</code> command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc debug insecure-app-7d8667f64b-cvkcz
<span class="o">(</span>pod<span class="o">)</span> <span class="nv">$ </span>curl <span class="nt">-v</span> insecure-app-this-is-insecure.apps-crc.testing
      ....
      &lt; HTTP/1.1 200 OK
      &lt; server: nginx
      &lt; <span class="nb">date</span>: Sat, 26 Feb 2022 15:20:53 GMT
      &lt; content-type: text/html
      &lt; content-length: 615
      &lt; last-modified: Tue, 15 Feb 2022 23:05:56 GMT
      &lt; etag: <span class="s2">"620c31d4-267"</span>
      &lt; x-frame-options: SAMEORIGIN
      &lt; accept-ranges: bytes
      &lt; set-cookie: <span class="nv">cef860fd45f3b8c73246fd4b31240250</span><span class="o">=</span>22b324be48072691fec3f3ebe83c8473<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> HttpOnly
      &lt; cache-control: private
      ....
</pre></table></code></div></div><p>And that’s that!</p><h2 id="creating-a-secure-route">Creating a secure route<a href="#creating-a-secure-route"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now we will create a route but we will secure it with a TLS/SSL cert. The route will be called <code class="language-plaintext highlighter-rouge">secure-route</code> with the hostname <code class="language-plaintext highlighter-rouge">secure-app-this-is-secure.apps-crc.testing</code> in our project <code class="language-plaintext highlighter-rouge">this-is-secure</code> with the app <code class="language-plaintext highlighter-rouge">secure-app</code>:</p><p>Creating a project and app:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc new-project this-is-secure
<span class="nv">$ </span>oc new-app <span class="nt">--name</span> secure-app <span class="nt">--image</span> bitnami/nginx
</pre></table></code></div></div><p>Now we will create the secure route:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc create route edge secure-route <span class="se">\</span>
  <span class="nt">--service</span> secure-app <span class="se">\</span>
  <span class="nt">--hostname</span> secure-app-this-is-secure.apps-crc.testing <span class="se">\</span>
  <span class="nt">--key</span> secure-app.key <span class="se">\</span>
  <span class="nt">--cert</span> secure-app.crt 
</pre></table></code></div></div><h3 id="testing-our-secure-route">Testing our secure route<a href="#testing-our-secure-route"><i class="fas fa-hashtag"></i></a></h3></h3><p>Let’s check it using <code class="language-plaintext highlighter-rouge">oc debug PODNAME</code>, don’t forget to add the <code class="language-plaintext highlighter-rouge">-v</code> (verbose) and <code class="language-plaintext highlighter-rouge">-k</code> (insecure) flag’s to the <code class="language-plaintext highlighter-rouge">curl</code> command otherwise you will not see the protocol and it will throw up an error because the SSL certificate is not signed by a valid CA:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nv">$ </span>oc debug secure-app-bccd9557b-s2nd4
<span class="o">(</span>pod<span class="o">)</span> <span class="nv">$ </span>curl <span class="nt">-vk</span> https://secure-app-this-is-secure.apps-crc.testing
      <span class="k">*</span>  SSL certificate verify result: self signed certificate <span class="o">(</span>18<span class="o">)</span>, continuing anyway.
      <span class="o">&gt;</span> GET / HTTP/1.1
      <span class="o">&gt;</span> Host: secure-app-this-is-secure.apps-crc.testing
      <span class="o">&gt;</span> User-Agent: curl/7.64.0
      <span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
      <span class="o">&gt;</span>
      <span class="k">*</span> TLSv1.3 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Newsession Ticket <span class="o">(</span>4<span class="o">)</span>:
      <span class="k">*</span> TLSv1.3 <span class="o">(</span>IN<span class="o">)</span>, TLS handshake, Newsession Ticket <span class="o">(</span>4<span class="o">)</span>:
      <span class="k">*</span> old SSL session ID is stale, removing
      &lt; HTTP/1.1 200 OK
      &lt; server: nginx
      &lt; <span class="nb">date</span>: Sat, 26 Feb 2022 15:29:16 GMT
      &lt; content-type: text/html
      &lt; content-length: 615
      &lt; last-modified: Tue, 15 Feb 2022 23:05:56 GMT
      &lt; etag: <span class="s2">"620c31d4-267"</span>
      &lt; x-frame-options: SAMEORIGIN
      &lt; accept-ranges: bytes
      &lt; set-cookie: <span class="nv">0e799158437fe6ddd46e0e7a82dd3c25</span><span class="o">=</span>25f02ff58528846c979c113d77ea289e<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/<span class="p">;</span> HttpOnly<span class="p">;</span> Secure<span class="p">;</span> <span class="nv">SameSite</span><span class="o">=</span>None
      &lt; cache-control: private
.... 
</pre></table></code></div></div><h1 id="wrapping-up">Wrapping up</h1><p>The way that services and routes play together is a fundamental building block of exposing your applications to the outside world in a safe way. The thing that I found so confusing is that <code class="language-plaintext highlighter-rouge">oc expose</code> creates routes just like <code class="language-plaintext highlighter-rouge">oc create route</code> but in the insecure way.</p><p>I hope this post has helped you. Check out my other EX280 related content on my <a href="https://blog.benstein.nl/ex280/">EX280 page</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ex280/'>EX280</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/openshift/" class="post-tag no-text-decoration" >openshift</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/ex280/" class="post-tag no-text-decoration" >ex280</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Exposing services with routes and SSL - Christian's Blog&url=https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Exposing services with routes and SSL - Christian's Blog&u=https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Exposing services with routes and SSL - Christian's Blog&url=https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hey-for-loadtesting-http/">hey for load testing http applications</a><li><a href="/posts/building-the-montsinger-rebound-s/">Build-log: Montsinger Rebound-S</a><li><a href="/posts/lets-get-fuzzy/">Let's get fuzzys</a><li><a href="/posts/creating-a-ex280-page/">Creating my EX280 page on Jekyll</a><li><a href="/posts/troubelshooting-permissions-on-pods/">ServiceAccounts and SCCs - Running pods with more permission's</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/controlling-pod-rollout-and-scaling/"><div class="card-body"> <em class="timeago small" date="2022-01-23 00:00:00 +0100" >Jan 23</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Scaling applications - Rollout, Scale and Auto-Scale Deployments</h3><div class="text-muted small"><p> This post is gonna be a bit bigger broader then what is requested on the EX280 exam objectives. In this post we will have a look at: Controlling roll-out of pods (manually rolling out or back a ...</p></div></div></a></div><div class="card"> <a href="/posts/quotas-limits-and-limit-ranges/"><div class="card-body"> <em class="timeago small" date="2022-01-29 00:00:00 +0100" >Jan 29</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Quotas, limits and limit-ranges</h3><div class="text-muted small"><p> In this post we will be diving in to quotas and limits. Quotas and limits can be used to allocate, limit en reserve resources within your cluster for one or multiple namepaces and can limit the usa...</p></div></div></a></div><div class="card"> <a href="/posts/pod-affinity-and-anti-affinity/"><div class="card-body"> <em class="timeago small" date="2022-02-06 00:00:00 +0100" >Feb 6</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Pod Affinity and Anti-affinity - Spreading out workloads</h3><div class="text-muted small"><p> I have written about using Taints and Tolerations to prevent pods from running on certain (tainted) nodes and there is some influence on scheduling that we can exert using Limits and Requests. But...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/setting-up-auth-and-users/" class="btn btn-outline-primary" prompt="Older"><p>Manage users and policies, groups and permissions</p></a> <a href="/posts/controlling-network-access-in-openshift/" class="btn btn-outline-primary" prompt="Newer"><p>Controlling Ingress with Openshift Network Policy's</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://kingofspades.github.io/posts/exposing-services-with-routes-and-ssl/'; this.page.identifier = '/posts/exposing-services-with-routes-and-ssl/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://https-blog-benstein-nl.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/KingOfSpades">Christian A. Benstein</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ex280/">ex280</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/openshift/">openshift</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/cli/">cli</a> <a class="post-tag" href="/tags/customization/">customization</a> <a class="post-tag" href="/tags/alfred/">alfred</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/azure/">azure</a> <a class="post-tag" href="/tags/devops/">devops</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { let initTheme = "default"; if ($("html[mode=dark]").length > 0 || ($("html[mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-9VZBEPDENQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-9VZBEPDENQ'); }); </script>
